const characters = {
    Astaroth: {
        name: "Astaroth",
        description: "O Demônio Astaroth",
        token: "Astaroth.png"
    },
    Baltazar: {
        name: "Baltazar",
        description: "O Paladino",
        token: "Baltazar.png"
    },
    Cadman: {
        name: "Cadman",
        description: "Comerciante de Pípiltin",
        token: "Cadman.png"
    },
    Diego: {
        name: "Diego",
        description: "O Inventor da Azzip",
        token: "Diego.png"
    },
    Dorian: {
        name: "Dorian",
        description: "O Curandeiro de Pípiltin",
        token: "Dorian.png"
    },
    Hakon: {
        name: "Hakon",
        description: "O Mestre Místico de Pípiltin",
        token: "Hakon.png"
    },
    Henri: {
        name: "Henri",
        description: "O Braço direito de James",
        token: "Henri.png"
    },
    Irene: {
        name: "Irene",
        description: "A curandeira misteriosa",
        token: "Irene.png"
    },
    Isabelle: {
        name: "Isabelle",
        description: "A barda dracônica",
        token: "Isabelle.png"
    },
    Ivor: {
        name: "Ivor",
        description: "O mago de Piphet",
        token: "Ivor.png"
    },
    JackCooper: {
        name: "Jack Cooper",
        description: "O caçador de Yharnam",
        token: "Jack_Cooper.png"
    },
    James: {
        name: "James",
        description: "O capitão",
        token: "James.png"
    },
    Jane: {
        name: "Jane",
        description: "A pirata",
        token: "Jane.png"
    },
    Lina: {
        name: "Lina",
        description: "A ladina de ???",
        token: "Lina.png"
    },
    LordeDoSubmundo: {
        name: "Lorde do Submundo",
        description: "O Lorde do Submundo",
        token: "Lorde_do_submundo.png"
    },
    Lucas: {
        name: "Lucas",
        description: "O caçador de Pípiltin",
        token: "Lucas.png"
    },
    Magnus: {
        name: "Magnus",
        description: "O Rei de Urgressus",
        token: "Magnus.png"
    },
    Mary: {
        name: "Mary",
        description: "A pirata pistoleira",
        token: "Mary.png"
    },
    Matiza: {
        name: "Matiza",
        description: "O campeão da velha guarda",
        token: "Matiza.png"
    },
    Rebeca: {
        name: "Rebeca",
        description: "A feiticeira",
        token: "Rebeca.png"
    },
    Sabnock: {
        name: "Sabnock",
        description: "???",
        token: "Sabnock.png"
    },
    Spamton: {
        name: "Spamton",
        description: "O familiar de Jack Cooper",
        token: "Spamton.png"
    },
    Spike: {
        name: "Spike",
        description: "Demônio de Mictlan",
        token: "Spike.png"
    },
    Tyrion: {
        name: "Tyrion",
        description: "O encantador de Pípiltin",
        token: "Tyrion.png"
    },
    Willian: {
        name: "Willian",
        description: "O paladino misterioso",
        token: "Willian.png"
    },
    Yareth: {
        name: "Yareth",
        description: "O mago de sangue",
        token: "Yareth.png"
    },
    Zotikotita: {
        name: "Zotikotita",
        description: "A Entidade da Vida",
        token: "Zotikotita.png"
    },
    Avna: {
        name: "Avna",
        description: "Os dez braços direitos do Lorde",
        token: "Avna.png"
    },
    Bellus: {
        name: "Bellus",
        description: "A máscara de Celestia",
        token: "Bellus.png"
    },
    Berriel: {
        name: "Berriel",
        description: "O demônio brincalhão",
        token: "Berrial.png"
    },
    Boris: {
        name: "Boris",
        description: "O Capitão Brasil",
        token: "Boris.png"
    },
    Luke: {
        name: "Luke",
        description: "O homem que não faz flexão, ele empurra a terra para baixo",
        token: "Luke.png"
    },
    Maria: {
        name: "Maria",
        description: "A Ladina",
        token: "Maria.png"
    },
    Niberius: {
        name: "Niberius",
        description: "O paladino da vingança",
        token: "Pai_do_Arth.png"
    },
    RhannyGallahar: {
        name: "Rhanny Gallahar",
        description: "A prodígia de Pípiltin",
        token: "Rhanny Gallahar.png"
    },
    Sif: {
        name: "Sif",
        description: "???",
        token: "Sif.png"
    },
    Callan: {
        name: "Callan",
        description: "???",
        token: "Callan.png"
    },
    Emma: {
        name: "Emma",
        description: "A Mestra Arcana de Metalurgis",
        token: "Emma.png"
    },
    Volga: {
        name: "Volga",
        description: "O Rei dos Dragões",
        token: "Volga.png"
    },
    Alduim: {
        name: "Alduim",
        description: "O Dragão Branco Ancião",
        token: "Alduim.png"
    },
    Niti: {
        name: "Niti",
        description: "A Guardiã da Justiça",
        token: "Niti.png"
    },
    Nayahath: {
        name: "Nayahath",
        description: "A Entidade do Arcanismo",
        token: "Nayahath.png"
    },
    Kataha: {
        name: "Kataha",
        description: "A Mestra das Lâminas",
        token: "Kataha.png"
    },
    Parvatam: {
        name: "Parvatam",
        description: "O Guardião das Montanhas",
        token: "Parvatam.png"
    },
    Acalhueltecani: {
        name: "Acalhueltecani",
        description: "O Guia de Mictlan",
        token: "Acalhueltecani.png"
    },
    Illidan: {
        name: "Illidan",
        description: "O Ladino Elfo",
        token: "Illidan.png"
    },
    Tyrania: {
        name: "Tyrania",
        description: "O Demônio de Mictlan",
        token: "Tyrania.png"
    },
    Laura: {
        name: "Laura",
        description: "A bibliotecária de Pípiltin",
        token: "Laura.png"
    },
    Nosferato: {
        name: "Nosferato",
        description: "O alquimista de Pípiltin",
        token: "Nosferato.png"
    },
    Syneidisis: {
        name: "Syneídisis",
        description: "O Ego",
        token: "Syneídisis.png"
    },
    Joana: {
        name: "Joana",
        description: "A curandeira de Pípiltin",
        token: "Joana.png"
    },
    Wallace: {
        name: "Wallace",
        description: "???",
        token: "Wallace.png"
    }
}

let charList = []

const Game = {
    score: 0, // pontos acumulados por vitórias
    numberOfCards: 8,
    uncollectedList: [], // cartas em jogo, ainda não descobertas
    collectedList: [] // cartas descobertas
}

for(character in characters){
    console.log(character)
    charList.push(character)
}

function generateRandomGame(){
    let temp = [...charList]
    let randomIterable
    let selection = []
    for(i = 0; i < Game.numberOfCards; i++){
        randomIterable = parseInt(Math.random() * temp.length)
        selection.push(temp[randomIterable])
        selection.push(temp[randomIterable])
        temp.splice(randomIterable, 1)

    }
    console.log(selection)
    console.log(temp)
    Game.uncollectedList = [...selection]
}
function shuffle(){
    // criar uma função que embaralhe a lista duplicada de personagens selecionados
    let temp = [...Game.uncollectedList]
    let shuffledList = []
    for(i = 0; i < Game.uncollectedList.length; i++){
        let randomNum = parseInt(Math.random() * temp.length)
        shuffledList.push(temp[randomNum])
        temp.splice(randomNum, 1)
    }
    console.log(temp) // must be empty
    console.log(shuffledList)

    Game.uncollectedList = [...shuffledList]
}

function fillGameArea(){
    let gameArea = document.querySelector('.cardsArea')
    gameArea.innerHTML = ''
    let id = 0
    for(character of Game.uncollectedList){
        console.log(character)
        gameArea.innerHTML += `
        <div class="card ${character}" id="card-${id}" onclick="selectCard(${id})">
            <div class="card-image" style="background-image: url('./img/${characters[character].token}');"></div>
            <div class="card-text">${characters[character].name}</div>
        </div>
        `
        id++
    }
}

function initialize(){
    clearAll()
    generateRandomGame()
    shuffle()
    fillGameArea()
    Game.collectedList = []
}
initialize()
generateNumberSelectOptions()
let flippedNumber = 0

function selectCard(id){
    let selectedCard = document.getElementById(`card-${id}`)
    
    console.log(selectedCard)
    if (flippedNumber < 2 && !selectedCard.classList.contains("flipped")) {
        
        selectedCard.classList.add("flipped")
        
        flippedNumber++
        pair.push(selectedCard.classList[1])
        if (flippedNumber >= 2){
            setTimeout(unflipAll, 1000)
        }
    }
    
}

let pair = []

function unflipAll(){
    let last = document.querySelector(".last")
    flippedNumber = 0
    let flippedCards = document.querySelectorAll(".flipped")
    console.log(flippedCards)
    for(i = 0; i < flippedCards.length; i++){
        console.log(flippedCards[i])
        if(flippedCards[i].classList.contains("flipped")){
            if (pair[0] == pair[1]){
                flippedCards[i].classList.add("hidden-card")
            }
            flippedCards[i].classList.remove("flipped")
        }
        
    }
    last.innerHTML = `
    <div class="card-image" style="background-image: url('./img/${characters[pair[0]].token}');"></div>
    <div class="card-image" style="background-image: url('./img/${characters[pair[1]].token}');"></div>
    `
    if (pair[0] == pair[1]){
        Game.collectedList.push(pair[0])
        Game.score++
    }

    renderScore()
    renderCollected()
    
    pair = []
}

function renderCollected(){
    let collectedArea = document.querySelector(".collectedArea")
    collectedArea.innerHTML = ''
    for(index in Game.collectedList){
        let temp = characters[Game.collectedList[index]]
        collectedArea.innerHTML += `
        <div class="cardCollected">
            <div class="cardCollected-image" style="background-image: url('./img/${temp.token}');"></div>
            <div class="cardCollected-text">
                <h3>${temp.name}</h3>
                <h4>${temp.description}</h4>
            </div>
        </div>
        `
    }
}

function renderScore(){
    let score = document.querySelector('.score-value')
    score.innerText = Game.score
}

function refreshConfig(){
    let numberOfCards = document.querySelector("#numberOfCards-config")
    console.log(numberOfCards)
    Game.numberOfCards = numberOfCards.value

}

function generateNumberSelectOptions(){
    let select = document.querySelector("#numberOfCards-config")
    select.innerHTML = ''
    for(i = 0; i < charList.length; i++){
        if(i+1 == Game.numberOfCards){
            select.innerHTML += `
        <option value="${i+1}" selected>${i+1}</option>
        `
            continue
        }
        select.innerHTML += `
        <option value="${i+1}">${i+1}</option>
        `
    }
}
function clearAll(){
    let cardsArea = document.querySelector(".cardsArea")
    let collectedArea = document.querySelector(".collectedArea")

    cardsArea.innerHTML = ''
    collectedArea.innerHTML = "Nothing yet"
}